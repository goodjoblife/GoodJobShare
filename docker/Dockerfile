FROM node:16

COPY . /app

WORKDIR /app

ARG RAZZLE_API_HOST
ARG RAZZLE_FACEBOOK_APP_ID
ARG RAZZLE_GA_MEASUREMENT_ID
ARG RAZZLE_GTM_ID
ARG RAZZLE_PIXEL_ID
ARG RAZZLE_GOOGLE_APP_ID
ARG RAZZLE_ENVIRONMENT
ARG RAZZLE_TAP_PAY_APP_ID
ARG RAZZLE_TAP_PAY_APP_KEY
ARG RAZZLE_TAP_PAY_SERVER_TYPE

ENV RAZZLE_API_HOST="${RAZZLE_API_HOST}" \
    RAZZLE_FACEBOOK_APP_ID="${RAZZLE_FACEBOOK_APP_ID}" \
    RAZZLE_GA_MEASUREMENT_ID="$RAZZLE_GA_MEASUREMENT_ID" \
    RAZZLE_GTM_ID="$RAZZLE_GTM_ID" \
    RAZZLE_PIXEL_ID="$RAZZLE_PIXEL_ID" \
    RAZZLE_GOOGLE_APP_ID="$RAZZLE_GOOGLE_APP_ID" \
    RAZZLE_ENVIRONMENT="$RAZZLE_ENVIRONMENT" \
    RAZZLE_TAP_PAY_APP_ID="$RAZZLE_TAP_PAY_APP_ID" \
    RAZZLE_TAP_PAY_APP_KEY="$RAZZLE_TAP_PAY_APP_KEY" \
    RAZZLE_TAP_PAY_SERVER_TYPE="$RAZZLE_TAP_PAY_SERVER_TYPE"

RUN yarn install && yarn run build && yarn cache clean

ENV NODE_ENV=production PORT=3000

EXPOSE 3000

CMD ["npm", "run", "start-production"]
